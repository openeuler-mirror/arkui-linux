{"version":3,"file":"rollup-plugin-tslint.es.js","sources":["../src/index.js"],"sourcesContent":["import path from 'path'\nimport ts from 'typescript'\nimport { createFilter } from 'rollup-pluginutils'\nimport { Linter, Configuration } from 'tslint'\n\nfunction normalizePath (id) {\n  return path\n    .relative(process.cwd(), id)\n    .split(path.sep)\n    .join('/')\n}\n\nfunction isString (value) {\n  return Object.prototype.toString.call(value) === '[object String]'\n}\n\nexport default function tslint (options = {}) {\n  let linter\n\n  const filter = createFilter(\n    options.include,\n    options.exclude || 'node_modules/**'\n  )\n\n  // formatter: \"stylish\"\n  // rulesDirectory: null,\n  // formattersDirectory: \"customFormatters/\"\n\n  const tsConfigSearchPath = options.tsConfigSearchPath || process.cwd()\n  const tsConfigFile = ts.findConfigFile(tsConfigSearchPath, ts.sys.fileExists)\n\n  const config = {\n    fix: options.fix || false,\n    formatter: options.formatter || 'stylish',\n    formattersDirectory: options.formattersDirectory || null,\n    rulesDirectory: options.rulesDirectory || null\n  }\n\n  return {\n    name: 'tslint',\n    sourceMap: false,\n\n    options () {\n      const program = Linter.createProgram(tsConfigFile)\n\n      linter = new Linter(config, program)\n    },\n\n    transform (code, id) {\n      const fileName = normalizePath(id)\n      if (!filter(id)) {\n        return null\n      }\n\n      const configuration =\n        options.configuration === null ||\n        options.configuration === undefined ||\n        isString(options.configuration)\n          ? Configuration.findConfiguration(\n            options.configuration || null,\n            fileName\n          ).results\n          : Configuration.parseConfigFile(options.configuration, process.cwd())\n\n      linter.lint(id, code, configuration)\n      const result = linter.getResult()\n\n      // Clear all results for current file from tslint\n      linter.failures = []\n      linter.fixes = []\n\n      const hasWarnings = options.throwOnWarning && result.warningCount !== 0\n      const hasErrors = (options.throwOnError || options.throwError) && result.errorCount !== 0\n\n      if (result.errorCount || result.warningCount) {\n        console.log(result.output)\n      }\n\n      if (hasWarnings && hasErrors) {\n        throw Error('Warnings or errors were found')\n      }\n\n      if (hasWarnings) {\n        throw Error('Warnings were found')\n      }\n\n      if (hasErrors) {\n        throw Error('Errors were found')\n      }\n    }\n  }\n}\n"],"names":["let","const"],"mappings":";;;;;AAKA,SAAS,aAAa,EAAE,EAAE,EAAE;EAC1B,OAAO,IAAI;KACR,QAAQ,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC;KAC3B,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC;KACf,IAAI,CAAC,GAAG,CAAC;CACb;;AAED,SAAS,QAAQ,EAAE,KAAK,EAAE;EACxB,OAAO,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,iBAAiB;CACnE;;AAED,AAAe,SAAS,MAAM,EAAE,OAAY,EAAE;mCAAP,GAAG;;EACxCA,IAAI,OAAM;;EAEVC,IAAM,MAAM,GAAG,YAAY;IACzB,OAAO,CAAC,OAAO;IACf,OAAO,CAAC,OAAO,IAAI,iBAAiB;IACrC;;;;;;EAMDA,IAAM,kBAAkB,GAAG,OAAO,CAAC,kBAAkB,IAAI,OAAO,CAAC,GAAG,GAAE;EACtEA,IAAM,YAAY,GAAG,EAAE,CAAC,cAAc,CAAC,kBAAkB,EAAE,EAAE,CAAC,GAAG,CAAC,UAAU,EAAC;;EAE7EA,IAAM,MAAM,GAAG;IACb,GAAG,EAAE,OAAO,CAAC,GAAG,IAAI,KAAK;IACzB,SAAS,EAAE,OAAO,CAAC,SAAS,IAAI,SAAS;IACzC,mBAAmB,EAAE,OAAO,CAAC,mBAAmB,IAAI,IAAI;IACxD,cAAc,EAAE,OAAO,CAAC,cAAc,IAAI,IAAI;IAC/C;;EAED,OAAO;IACL,IAAI,EAAE,QAAQ;IACd,SAAS,EAAE,KAAK;;IAEhB,yBAAO,IAAI;MACTA,IAAM,OAAO,GAAG,MAAM,CAAC,aAAa,CAAC,YAAY,EAAC;;MAElD,MAAM,GAAG,IAAI,MAAM,CAAC,MAAM,EAAE,OAAO,EAAC;KACrC;;IAED,6BAAS,EAAE,IAAI,EAAE,EAAE,EAAE;MACnBA,IAAM,QAAQ,GAAG,aAAa,CAAC,EAAE,EAAC;MAClC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;QACf,OAAO,IAAI;OACZ;;MAEDA,IAAM,aAAa;QACjB,OAAO,CAAC,aAAa,KAAK,IAAI;QAC9B,OAAO,CAAC,aAAa,KAAK,SAAS;QACnC,QAAQ,CAAC,OAAO,CAAC,aAAa,CAAC;YAC3B,aAAa,CAAC,iBAAiB;YAC/B,OAAO,CAAC,aAAa,IAAI,IAAI;YAC7B,QAAQ;WACT,CAAC,OAAO;YACP,aAAa,CAAC,eAAe,CAAC,OAAO,CAAC,aAAa,EAAE,OAAO,CAAC,GAAG,EAAE,EAAC;;MAEzE,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,aAAa,EAAC;MACpCA,IAAM,MAAM,GAAG,MAAM,CAAC,SAAS,GAAE;;;MAGjC,MAAM,CAAC,QAAQ,GAAG,GAAE;MACpB,MAAM,CAAC,KAAK,GAAG,GAAE;;MAEjBA,IAAM,WAAW,GAAG,OAAO,CAAC,cAAc,IAAI,MAAM,CAAC,YAAY,KAAK,EAAC;MACvEA,IAAM,SAAS,GAAG,CAAC,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,UAAU,KAAK,MAAM,CAAC,UAAU,KAAK,EAAC;;MAEzF,IAAI,MAAM,CAAC,UAAU,IAAI,MAAM,CAAC,YAAY,EAAE;QAC5C,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAC;OAC3B;;MAED,IAAI,WAAW,IAAI,SAAS,EAAE;QAC5B,MAAM,KAAK,CAAC,+BAA+B,CAAC;OAC7C;;MAED,IAAI,WAAW,EAAE;QACf,MAAM,KAAK,CAAC,qBAAqB,CAAC;OACnC;;MAED,IAAI,SAAS,EAAE;QACb,MAAM,KAAK,CAAC,mBAAmB,CAAC;OACjC;KACF;GACF;CACF;;;;"}